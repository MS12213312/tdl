<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>To-do list</title>
    <link rel="stylesheet" href="toDoList.css">

</head>

<body>

<table id="tasksTable"></table>

    <div class="inputContainer">
        <div>
            <div>Oppgave</div>
            <input id="taskDescription" type="text" placeholder="Oppgavenavn"/><br>
        </div>
        <div>
            <div>Person</div>
            <input id="taskPerson" type="text" placeholder="Personens navn"/><br>
        </div>
        <div>
            <div>Frist</div>
            <input id="taskDeadline" type="date"/>
        </div>
    </div>
    
    <button onclick="addTask()">Legg til oppgave</button>

<script>
    // Model
    let tasks = [
        {description: 'Oppgave 1', 
         person: "Person 1",
         deadline: new Date("2019-02-13").toLocaleDateString(),
         doneDate: new Date("2019-02-12").toLocaleDateString(),
         isDone: false},
    ];



    // View
    let tasksTable = document.getElementById('tasksTable');
    show();

    function show() {

        let html = `
                    <tr>
                        <th class="taskTableHeader">Oppgave</th>
                        <th class="taskTableHeader">Person</th>
                        <th>Gjort</th>
                        <th class="dateTableHeader">Frist</th>
                        <th class="dateTableHeader">Dato gjort</th>
                        <th class="buttonsTableHeader"></th>
                    </tr>
                `;
                
        for (let i = 0; i < tasks.length; i++) {
            html += createHtmlRow(i);
        }
        tasksTable.innerHTML = html;
    }

    function createHtmlRow(i) {
        const task = tasks[i];
        const checkedHtml = task.isDone ? 'checked="checked"' : '';
                
        if (!task.editMode)
        
            return `
                    <tr>
                        <td>${task.description}</td>
                        <td>${task.person}</td>
                    <td class="checkboxTableData"><input onchange="changeIsDone(this, ${i})" type="checkbox" ${checkedHtml} /></td>
                        <td class="dateTableData">${task.deadline}</td>
                        <td class="dateTableData">${task.doneDate}</td>
                        <td>
                            <button onclick="deleteTask(${i})">Slett</button>
                            <button onclick="editTask(${i})">Rediger</button>
                            <button onclick="moveTask(${i}, 'up')">↑</button>
                            <button onclick="moveTask(${i}, 'down')">↓</button>
                        </td>
                    </tr>
                    `;

        return `
                <tr>
                    <td><input id="editDescription${i}" type="text" value="${task.description}"/></td>
                    <td><input id="editPerson${i}" type="text" value="${task.person}"/></td>
                    <td class="checkboxTableData"><input onchange="changeIsDone(this, ${i})" type="checkbox" ${checkedHtml}/></td>
                    <td class="dateTableData">
                        <input id="editDeadline${i}" type="date"
                        value="${
                        task.deadline != "" ? new Date(task.deadline).toISOString().substring(0, 10) : ""
                        }"/>
                    </td>
                    <td class="dateTableData">${task.doneDate}</td>
                    <td>
                        <button onclick="updateTask(${i})">Lagre</button>
                        <button onclick="moveTask(${i}, 'up')">↑</button>
                        <button onclick="moveTask(${i}, 'down')">↓</button>
                    </td>

                </tr>
                `;             
    }


    
    // Controller
    let taskDescInput = document.getElementById('taskDescription');
    let taskPersonInput = document.getElementById('taskPerson');
    let taskDeadlineInput = document.getElementById('taskDeadline');

    function addTask() {
        tasks.push({
            description: taskDescInput.value,
            person: taskPersonInput.value,
            deadline: ( taskDeadlineInput.value != "" ? new Date(taskDeadlineInput.value).toLocaleDateString() : "" ),
            doneDate: "",
            isDone: false}
        );

        taskDescInput.value = '';
        taskPersonInput.value = '';
        taskDeadlineInput.value = '';
        show();
    }

    function changeIsDone(checkbox, index) {
        tasks[index].isDone = checkbox.checked;
        tasks[index].doneDate = checkbox.checked ? (new Date()).toLocaleDateString() : '';
        show();
    }

    function deleteTask(index) {
        tasks.splice(index, 1);
        show();
    }

    function editTask(index) {
        tasks[index].editMode = true;
        show();
    }

    function moveTask(index, direction){

        let temp;
        let selected = Number(index);
        let above = index - 1;
        let below = Number(index + 1);

        switch(tasks.length > 1){

            case true:

                switch(direction){
                    case "up":
                        switch(selected !== 0){
                            case true:
                                temp = tasks[above];
                                tasks[above] = tasks[selected];
                                tasks[selected] = temp;
                        }
                        break;

                    case "down":
                        switch(selected !== tasks.length - 1){
                            case true:
                                temp = tasks[below];
                                tasks[below] = tasks[selected];
                                tasks[selected] = temp;
                        }
                }
        }
        show();
    }

    function updateTask(index) {
        const descId = `editDescription${index}`;
        const personId = `editPerson${index}`;
        const deadlineId  = `editDeadline${index}`;

        const descInputTag = document.getElementById(descId);
        const personInputTag = document.getElementById(personId);
        const deadlineInputTag = document.getElementById(deadlineId);

        const task = tasks[index];

        task.description = descInputTag.value;
        task.person = personInputTag.value;
        task.deadline = ( deadlineInputTag.value != "" ? new Date(deadlineInputTag.value).toLocaleDateString() : "" );

        task.editMode = false;
        show();
    }
</script>
</body>
</html>
